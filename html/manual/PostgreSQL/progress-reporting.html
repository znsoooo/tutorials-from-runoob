<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>28.4. 进度报告</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="monitoring-locks.html" title="28.3. 查看锁" /><link rel="next" href="dynamic-trace.html" title="28.5. 动态追踪" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">28.4. 进度报告</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="monitoring-locks.html" title="28.3. 查看锁">上一页</a> </td><td width="10%" align="left"><a accesskey="u" href="monitoring.html" title="第 28 章 监控数据库活动">上一级</a></td><th width="60%" align="center">第 28 章 监控数据库活动</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.1 手册">起始页</a></td><td width="10%" align="right"> <a accesskey="n" href="dynamic-trace.html" title="28.5. 动态追踪">下一页</a></td></tr></table><hr></hr></div><div class="sect1" id="PROGRESS-REPORTING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">28.4. 进度报告</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="progress-reporting.html#VACUUM-PROGRESS-REPORTING">28.4.1. VACUUM进度报告</a></span></dt></dl></div><p>   <span class="productname">PostgreSQL</span>能够在命令执行期间报告某些命令的进度。目前，唯一支持
   进度报告的命令是<code class="command">VACUUM</code>。未来可能会添加更多命令支持。
  </p><div class="sect2" id="VACUUM-PROGRESS-REPORTING"><div class="titlepage"><div><div><h3 class="title">28.4.1. VACUUM进度报告</h3></div></div></div><p>   每当<code class="command">VACUUM</code>运行时,
   <code class="structname">pg_stat_progress_vacuum</code>视图将包含每个后端
  （包括autovacuum工作进程）当前正在VACUUM的一行。下表描述了该报告视图提供的信息，
   并提供相应的信息注解。<code class="command">VACUUM FULL</code>当前不支持进度报告。运行
   <code class="command">VACUUM FULL</code>的后端将不会在此视图中列出。
  </p><div class="table" id="PG-STAT-PROGRESS-VACUUM-VIEW"><p class="title"><strong>表 28.21. <code class="structname">pg_stat_progress_vacuum</code> 视图</strong></p><div class="table-contents"><table class="table" summary="pg_stat_progress_vacuum 视图" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>列</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code class="structfield">pid</code></td><td><code class="type">integer</code></td><td>这个后端的进程ID。</td></tr><tr><td><code class="structfield">datid</code></td><td><code class="type">oid</code></td><td>这个后端连接到的数据库的OID。</td></tr><tr><td><code class="structfield">datname</code></td><td><code class="type">name</code></td><td>这个后端连接到的数据库的名称。</td></tr><tr><td><code class="structfield">relid</code></td><td><code class="type">oid</code></td><td>当前被VACUUM的表的OID。</td></tr><tr><td><code class="structfield">phase</code></td><td><code class="type">text</code></td><td>       当前VACUUM的处理阶段。详见<a class="xref" href="progress-reporting.html#VACUUM-PHASES" title="表 28.22. VACUUM 的阶段">表 28.22</a>。
     </td></tr><tr><td><code class="structfield">heap_blks_total</code></td><td><code class="type">bigint</code></td><td>       当前被VACUUM的表堆数据块的总数。这个数字在扫描开始时被报告；之后增加的数据块
       不会（也不必）被当前<code class="command">VACUUM</code>访问。
     </td></tr><tr><td><code class="structfield">heap_blks_scanned</code></td><td><code class="type">bigint</code></td><td>       已扫描的堆数据块数。由于<a class="link" href="storage-vm.html" title="66.4. 可见性映射">可见性图</a>被用于优化
       扫描，因此某些块将被忽略而不进行检查；跳过的块也被包括在这个总数中，所以当
       VACUUM完成时，这个数字最终将等于<code class="structfield">heap_blks_total</code>。这个计数
       器只有在VACUUM的<code class="literal">扫描堆</code>阶段才会增长。
     </td></tr><tr><td><code class="structfield">heap_blks_vacuumed</code></td><td><code class="type">bigint</code></td><td>       已被VACUUM的堆数据块数。除非表中没有索引，否则这个计数器只有在VACUUM的
       <code class="literal">清理堆</code>阶段才会增长。不包含任何死亡元组的数据块将被跳过，因
       此该计数器的值有时会大幅跳跃式增加。
     </td></tr><tr><td><code class="structfield">index_vacuum_count</code></td><td><code class="type">bigint</code></td><td>       已完成的索引VACUUM数量。
     </td></tr><tr><td><code class="structfield">max_dead_tuples</code></td><td><code class="type">bigint</code></td><td>      在必须执行一次索引VACUUM前可存储的死亡元组数量。
      这基于<a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>的值。
     </td></tr><tr><td><code class="structfield">num_dead_tuples</code></td><td><code class="type">bigint</code></td><td>       自上一次索引VACUUM结束后，一共清理的死亡元组数量。
     </td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="VACUUM-PHASES"><p class="title"><strong>表 28.22. VACUUM 的阶段</strong></p><div class="table-contents"><table class="table" summary="VACUUM 的阶段" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>阶段</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">初始化</code></td><td>       <code class="command">VACUUM</code>正在准备开始扫描堆。这个阶段应该很简短。
     </td></tr><tr><td><code class="literal">扫描堆</code></td><td>       <code class="command">VACUUM</code>正在扫描堆。如果需要，它将会对每个页面进行修建以及碎片整理，并且可能会执行冻结动作。<code class="structfield">heap_blks_scanned</code>列可以用来监控扫描的进度。
     </td></tr><tr><td><code class="literal">清理索引</code></td><td>       <code class="command">VACUUM</code>当前正在清理索引。如果一个表拥有索引，那么每次清理时这个阶段会在堆扫描完成后至少发生一次。如果<a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>不足以存放找到的死亡元组，则每次清理时会多次清理索引。
     </td></tr><tr><td><code class="literal">清理堆</code></td><td>       <code class="command">VACUUM</code>当前正在清理堆。清理堆与扫描堆不是同一个概念，清理堆发生在每一次清理索引的实例之后。如果<code class="structfield">heap_blks_scanned</code>小于<code class="structfield">heap_blks_total</code>，系统将在这个阶段完成之后回去扫描堆；否则，系统将在这个阶段完成后开始清理索引。
     </td></tr><tr><td><code class="literal">清除索引</code></td><td>       <code class="command">VACUUM</code>当前正在清除索引。这个阶段发生在堆被完全扫描并且对堆和索引的所有清理都已经完成以后。
     </td></tr><tr><td><code class="literal">截断堆</code></td><td>       <code class="command">VACUUM</code>正在截断堆，以便把关系尾部的空页面返还给操作系统。这个阶段发生在清除完索引之后。
     </td></tr><tr><td><code class="literal">执行最后的清除</code></td><td>       <code class="command">VACUUM</code>在执行最终的清除。在这个阶段中，<code class="command">VACUUM</code>将清理空闲空间映射、更新<code class="literal">pg_class</code>中的统计信息并且将统计信息报告给统计收集器。当这个阶段完成时，<code class="command">VACUUM</code>也就结束了。
     </td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="monitoring-locks.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="monitoring.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="dynamic-trace.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">28.3. 查看锁 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 28.5. 动态追踪</td></tr></table></div></body></html>
